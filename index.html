<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <style>
    body {
      margin: 0 auto;
      padding: 0 2em;
      max-width: 800px;
      margin-bottom: 50px;
      line-height: 1.6em;
      font-family: sans-serif;
    }

    video {
      width: 100%;
      height: auto;
    }
  </style>

  <title>Mirror Window</title>
</head>

<body class="container">
  <h1>Mirror Window</h1>
  <div id='paused'>
    <div><button onclick="startCapture()">Select Window</button></div>
    <div>
      Cursor capture
      <select id="cursor">
        <option value="always">always</option>
        <option value="motion">motion</option>
        <option value="never">never</option>
      </select>
    </div>
    <div>
      Resolution (optional)
      <input id="width" type="number" min="0" max="9999" placeholder="width" />
      &times;
      <input id="height" type="number" min="0" max="9999" placeholder="height" />
    </div>
  </div>
  <div id='running' hidden>
    <button onclick="stopCapture()">Stop Mirroring</button>
    <button onclick="fullscreen()">Go Fullscreen</button>
    <video autoplay></video>
  </div>

  <script>
    let $ = document.querySelector.bind(document);
    let video = $('video');

    async function startCapture() {
      let displayMediaOptions = {
        video: {
          cursor: $('#cursor').value,
          width: $('#width').value || null,
          height: $('#height').value || null
        },
        audio: false
      };
      try {
        video.srcObject = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
      } catch(e) {
        console.log("Error getting video:", e);
        return;
      }
      video.srcObject.getTracks().forEach((track) => { console.log(track.getSettings()); });
      $('#paused').hidden = true;
      $('#running').hidden = false;
    }

    function stopCapture() {
      video.srcObject.getTracks().forEach((track) => { track.stop(); });
      video.srcObject = null;
      $('#paused').hidden = false;
      $('#running').hidden = true;
    }

    function fullscreen() {
      video.requestFullscreen();
    }
  </script>
</body>
</html>
