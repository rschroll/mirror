<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <style>
    body {
      margin: 0 auto;
      padding: 0 2em;
      max-width: 800px;
      margin-bottom: 50px;
      line-height: 1.6em;
      font-family: sans-serif;
    }

    video {
      width: 100%;
      height: auto;
    }
  </style>

  <title>Mirror Window</title>
</head>

<body class="container">
  <h1>Mirror Window</h1>
  <div id='paused'>
    <button onclick="startCapture()">Select Window</button>
  </div>
  <div id='running' hidden>
    <button onclick="stopCapture()">Stop Mirroring</button>
    <button onclick="fullscreen()">Go Fullscreen</button>
    <video autoplay></video>
  </div>

  <script>
    let $ = document.querySelector.bind(document);
    let video = $('video');

    async function startCapture() {
      let displayMediaOptions = {
        // Chrome pics video size from current display
        video: { cursor: 'always', /*aspectRatio: 1*/ },
        audio: false
      };
      try {
        video.srcObject = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
      } catch(e) {
        console.log("Error getting video:", e);
        return;
      }
      video.srcObject.getTracks().forEach((track) => { console.log(track.getSettings()); });
      $('#paused').hidden = true;
      $('#running').hidden = false;
    }

    function stopCapture() {
      video.srcObject.getTracks().forEach((track) => { track.stop(); });
      video.srcObject = null;
      $('#paused').hidden = false;
      $('#running').hidden = true;
    }

    function fullscreen() {
      video.requestFullscreen();
    }
  </script>
</body>
</html>
